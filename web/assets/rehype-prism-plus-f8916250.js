import{n as W}from"./parse-numeric-range-9242e1ec.js";import{r as q}from"./refractor-f0b25896.js";import{v as z}from"./unist-util-visit-4a8cdef4.js";import{t as w}from"./hast-util-to-string-00227f59.js";import{f as B}from"./unist-util-filter-35bc8277.js";function S(){S=function(r,n){return new i(r,void 0,n)};var t=RegExp.prototype,o=new WeakMap;function i(r,n,l){var g=new RegExp(r,n);return o.set(g,l||o.get(r)),N(g,i.prototype)}function e(r,n){var l=o.get(n);return Object.keys(l).reduce(function(g,f){var s=l[f];if(typeof s=="number")g[f]=r[s];else{for(var c=0;r[s[c]]===void 0&&c+1<s.length;)c++;g[f]=r[s[c]]}return g},Object.create(null))}return function(r,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),n&&N(r,n)}(i,RegExp),i.prototype.exec=function(r){var n=t.exec.call(this,r);if(n){n.groups=e(n,this);var l=n.indices;l&&(l.groups=e(l,this))}return n},i.prototype[Symbol.replace]=function(r,n){if(typeof n=="string"){var l=o.get(this);return t[Symbol.replace].call(this,r,n.replace(/\$<([^>]+)>/g,function(f,s){var c=l[s];return"$"+(Array.isArray(c)?c.join("$"):c)}))}if(typeof n=="function"){var g=this;return t[Symbol.replace].call(this,r,function(){var f=arguments;return typeof f[f.length-1]!="object"&&(f=[].slice.call(f)).push(e(f,g)),n.apply(this,f)})}return t[Symbol.replace].call(this,r,n)},S.apply(this,arguments)}function N(t,o){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},N(t,o)}function _(t,o){(o==null||o>t.length)&&(o=t.length);for(var i=0,e=new Array(o);i<o;i++)e[i]=t[i];return e}function O(t,o){var i=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=function(r,n){if(r){if(typeof r=="string")return _(r,n);var l=Object.prototype.toString.call(r).slice(8,-1);return l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set"?Array.from(r):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_(r,n):void 0}}(t))||o&&t&&typeof t.length=="number"){i&&(t=i);var e=0;return function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var D=function(t){return function(o){return o===void 0&&(o={}),function(e,r){if(r&&!e.registered(r))throw new Error('The default language "'+r+'" is not registered with refractor.')}(t,o.defaultLanguage),function(e){z(e,"element",i)};function i(e,r,n){var l,g;if(n&&n.tagName==="pre"&&e.tagName==="code"){var f=(e==null||(l=e.data)==null?void 0:l.meta)||(e==null||(g=e.properties)==null?void 0:g.metastring)||"";e.properties.className?typeof e.properties.className=="boolean"?e.properties.className=[]:Array.isArray(e.properties.className)||(e.properties.className=[e.properties.className]):e.properties.className=[];var s,c,d=function(p){for(var m,a=O(p.properties.className);!(m=a()).done;){var u=m.value;if(u.slice(0,9)==="language-")return u.slice(9).toLowerCase()}return null}(e);if(!d&&o.defaultLanguage&&e.properties.className.push("language-"+(d=o.defaultLanguage)),e.properties.className.push("code-highlight"),d)try{var A,j;j=(A=d)!=null&&A.includes("diff-")?d.split("-")[1]:d,s=t.highlight(w(e),j),n.properties.className=(n.properties.className||[]).concat("language-"+j)}catch(p){if(!o.ignoreMissing||!/Unknown language/.test(p.message))throw p;s=e}else s=e;s.children=(c=1,function p(m){return m.reduce(function(a,u){if(u.type==="text"){var h=u.value,v=(h.match(/\n/g)||"").length;if(v===0)u.position={start:{line:c,column:1},end:{line:c,column:1}},a.push(u);else for(var y,E=h.split(`
`),T=O(E.entries());!(y=T()).done;){var C=y.value,x=C[0],P=C[1];a.push({type:"text",value:x===E.length-1?P:P+`
`,position:{start:{line:c+x,column:1},end:{line:c+x,column:1}}})}return c+=v,a}if(Object.prototype.hasOwnProperty.call(u,"children")){var U=c;return u.children=p(u.children),a.push(u),u.position={start:{line:U,column:1},end:{line:c,column:1}},a}return a.push(u),a},[])})(s.children),s.position=s.children.length>0?{start:{line:s.children[0].position.start.line,column:0},end:{line:s.children[s.children.length-1].position.end.line,column:0}}:{start:{line:0,column:0},end:{line:0,column:0}};for(var L,$=function(p){var m=/{([\d,-]+)}/,a=p.split(",").map(function(v){return v.trim()}).join();if(m.test(a)){var u=m.exec(a)[1],h=W(u);return function(v){return h.includes(v+1)}}return function(){return!1}}(f),k=function(p){var m=S(/showLineNumbers=(\d+)/i,{lines:1});if(m.test(p)){var a=m.exec(p);return Number(a.groups.lines)}return 1}(f),b=function(p){for(var m=new Array(p),a=0;a<p;a++)m[a]={type:"element",tagName:"span",properties:{className:[]},children:[]};return m}(s.position.end.line),I=["showlinenumbers=false",'showlinenumbers="false"',"showlinenumbers={false}"],M=function(){var p,m,a=L.value,u=a[0],h=a[1];h.properties.className=["code-line"];var v=B(s,function(y){return y.position.start.line<=u+1&&y.position.end.line>=u+1});h.children=v.children,!f.toLowerCase().includes("showLineNumbers".toLowerCase())&&!o.showLineNumbers||I.some(function(y){return f.toLowerCase().includes(y)})||(h.properties.line=[(u+k).toString()],h.properties.className.push("line-number")),$(u)&&h.properties.className.push("highlight-line"),(d==="diff"||(p=d)!=null&&p.includes("diff-"))&&w(h).substring(0,1)==="-"?h.properties.className.push("deleted"):(d==="diff"||(m=d)!=null&&m.includes("diff-"))&&w(h).substring(0,1)==="+"&&h.properties.className.push("inserted")},R=O(b.entries());!(L=R()).done;)M();b.length>0&&w(b[b.length-1]).trim()===""&&b.pop(),e.children=b}}}},Q=D(q);export{Q as f};
