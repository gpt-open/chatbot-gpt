import{r as a}from"./react-dff1db10.js";import{L as le,R as b,P as v,T as g,a as ue,b as I,M as de,C as q,c as fe}from"./livekit-client-bb1568a6.js";import{l as pe}from"./loglevel-52fed41a.js";import{m as x,s as R,O as j,S as D}from"./rxjs-eb9efe3f.js";import{u as be,a as he}from"./usehooks-ts-f5852a9b.js";var X=(e,n,r)=>new Promise((t,o)=>{var i=l=>{try{h(r.next(l))}catch(s){o(s)}},c=l=>{try{h(r.throw(l))}catch(s){o(s)}},h=l=>l.done?t(l.value):Promise.resolve(l.value).then(i,c);h((r=r.apply(e,n)).next())}),ve="lk";function F(e){return typeof e>"u"?!1:me(e)||Se(e)}function me(e){var n;return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("track")&&typeof((n=e.publication)==null?void 0:n.track)<"u":!1}function Se(e){return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&e.hasOwnProperty("publication")&&typeof e.publication<"u":!1}function ge(e){return e?e.hasOwnProperty("participant")&&e.hasOwnProperty("source")&&typeof e.publication>"u":!1}function Y(e){if(typeof e=="string"||typeof e=="number")return`${e}`;if(ge(e))return`${e.participant.identity}_${e.source}_placeholder`;if(F(e))return`${e.participant.identity}_${e.publication.source}_${e.publication.trackSid}`;throw new Error(`Can't generate a id for the given track reference: ${e}`)}function Z(e){return e instanceof le}var Ee=[b.ConnectionStateChanged,b.RoomMetadataChanged,b.ActiveSpeakersChanged,b.ConnectionQualityChanged,b.ParticipantConnected,b.ParticipantDisconnected,b.ParticipantPermissionsChanged,b.ParticipantMetadataChanged,b.TrackMuted,b.TrackUnmuted,b.TrackPublished,b.TrackUnpublished,b.TrackStreamStateChanged,b.TrackSubscriptionFailed,b.TrackSubscriptionPermissionChanged,b.TrackSubscriptionStatusChanged],ke=[...Ee,b.LocalTrackPublished,b.LocalTrackUnpublished];v.TrackPublished,v.TrackUnpublished,v.TrackMuted,v.TrackUnmuted,v.TrackStreamStateChanged,v.TrackSubscribed,v.TrackUnsubscribed,v.TrackSubscriptionPermissionChanged,v.TrackSubscriptionFailed,v.LocalTrackPublished,v.LocalTrackUnpublished;var ye=[v.ConnectionQualityChanged,v.IsSpeakingChanged,v.ParticipantMetadataChanged,v.ParticipantPermissionsChanged,v.TrackMuted,v.TrackUnmuted,v.TrackPublished,v.TrackUnpublished,v.TrackStreamStateChanged,v.TrackSubscriptionFailed,v.TrackSubscriptionPermissionChanged,v.TrackSubscriptionStatusChanged];[...ye,v.LocalTrackPublished,v.LocalTrackUnpublished];var y=pe.getLogger("lk-components-js");y.setDefaultLevel("WARN");function ee(e){return typeof e=="object"}function ne(e){return Array.isArray(e)&&e.filter(ee).length>0}function $(e){return`${ve}-${e}`}function Ce(e){const n=U(e),r=z(e.participant).pipe(x(()=>U(e)),R(n));return{className:$(e.source===g.Source.Camera||e.source===g.Source.ScreenShare?"participant-media-video":"participant-media-audio"),trackObserver:r}}function U(e){if(F(e))return e.publication;{const{source:n,name:r,participant:t}=e;if(n&&r)return t.getTrackPublications().find(o=>o.source===n&&o.trackName===r);if(r)return t.getTrackPublicationByName(r);if(n)return t.getTrackPublication(n);throw new Error("At least one of source and name needs to be defined")}}function Pe(e,...n){return new j(t=>{const o=()=>{t.next(e)};return n.forEach(c=>{e.on(c,o)}),()=>{n.forEach(c=>{e.off(c,o)})}}).pipe(R(e))}function Te(e,n){return new j(t=>{const o=(...c)=>{t.next(c)};return e.on(n,o),()=>{e.off(n,o)}})}function we(e){return Te(e,b.ConnectionStateChanged).pipe(x(([n])=>n),R(e.state))}function Me(e,...n){return new j(t=>{const o=()=>{t.next(e)};return n.forEach(c=>{e.on(c,o)}),()=>{n.forEach(c=>{e.off(c,o)})}}).pipe(R(e))}function z(e){return Me(e,v.TrackMuted,v.TrackUnmuted,v.ParticipantPermissionsChanged,v.TrackPublished,v.TrackUnpublished,v.LocalTrackPublished,v.LocalTrackUnpublished,v.MediaDevicesError,v.TrackSubscriptionStatusChanged).pipe(x(r=>{const{isMicrophoneEnabled:t,isCameraEnabled:o,isScreenShareEnabled:i}=r,c=r.getTrackPublication(g.Source.Microphone),h=r.getTrackPublication(g.Source.Camera);return{isCameraEnabled:o,isMicrophoneEnabled:t,isScreenShareEnabled:i,cameraTrack:h,microphoneTrack:c,participant:r}}))}function _e(e,n,r,t,o){const{localParticipant:i}=n,c=(f,p)=>{let u=!1;switch(f){case g.Source.Camera:u=p.isCameraEnabled;break;case g.Source.Microphone:u=p.isMicrophoneEnabled;break;case g.Source.ScreenShare:u=p.isScreenShareEnabled;break}return u},h=z(i).pipe(x(f=>c(e,f.participant)),R(c(e,i))),l=new D,s=(f,p)=>X(this,null,function*(){try{switch(p??(p=r),l.next(!0),e){case g.Source.Camera:yield i.setCameraEnabled(f??!i.isCameraEnabled,p,t);break;case g.Source.Microphone:yield i.setMicrophoneEnabled(f??!i.isMicrophoneEnabled,p,t);break;case g.Source.ScreenShare:yield i.setScreenShareEnabled(f??!i.isScreenShareEnabled,p,t);break;default:break}}catch(u){if(o&&u instanceof Error)o==null||o(u);else throw u}finally{l.next(!1)}});return{className:$("button"),toggle:s,enabledObserver:h,pendingObserver:l.asObservable()}}function Re(){let e=!1;const n=new D,r=new D,t=i=>X(this,null,function*(){r.next(!0),e=i??!e,n.next(e),r.next(!1)});return{className:$("button"),toggle:t,enabledObserver:n.asObservable(),pendingObserver:r.asObservable()}}new TextEncoder;new TextDecoder;function Oe(){return{className:"lk-room-container"}}function Q(e,n,r=!0){const o=[e.localParticipant,...Array.from(e.remoteParticipants.values())],i=[];return o.forEach(c=>{n.forEach(h=>{const l=Array.from(c.trackPublications.values()).filter(s=>s.source===h&&(!r||s.track)).map(s=>({participant:c,publication:s,source:s.source}));i.push(...l)})}),{trackReferences:i,participants:o}}function xe(e,n,r){var t,o;const i=(t=r.additionalRoomEvents)!=null?t:ke,c=(o=r.onlySubscribed)!=null?o:!0,h=Array.from(new Set([b.ParticipantConnected,b.ParticipantDisconnected,b.ConnectionStateChanged,b.LocalTrackPublished,b.LocalTrackUnpublished,b.TrackPublished,b.TrackUnpublished,b.TrackSubscriptionStatusChanged,...i]).values());return Pe(e,...h).pipe(x(s=>{const d=Q(s,n,c);return y.debug(`TrackReference[] was updated. (length ${d.trackReferences.length})`,d),d}),R(Q(e,n,c)))}function te(e){var n,r,t="";if(typeof e=="string"||typeof e=="number")t+=e;else if(typeof e=="object")if(Array.isArray(e)){var o=e.length;for(n=0;n<o;n++)e[n]&&(r=te(e[n]))&&(t&&(t+=" "),t+=r)}else for(r in e)e[r]&&(t&&(t+=" "),t+=r);return t}function Ae(){for(var e,n,r=0,t="",o=arguments.length;r<o;r++)(e=arguments[r])&&(n=te(e))&&(t&&(t+=" "),t+=n);return t}var Le=Object.defineProperty,Ne=Object.defineProperties,Ie=Object.getOwnPropertyDescriptors,L=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable,G=(e,n,r)=>n in e?Le(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,C=(e,n)=>{for(var r in n||(n={}))re.call(n,r)&&G(e,r,n[r]);if(L)for(var r of L(n))ae.call(n,r)&&G(e,r,n[r]);return e},H=(e,n)=>Ne(e,Ie(n)),O=(e,n)=>{var r={};for(var t in e)re.call(e,t)&&n.indexOf(t)<0&&(r[t]=e[t]);if(e!=null&&L)for(var t of L(e))n.indexOf(t)<0&&ae.call(e,t)&&(r[t]=e[t]);return r};function V(e,n,r=!0){const[t,o]=a.useState(n);return a.useEffect(()=>{if(r&&o(n),typeof window>"u"||!e)return;const i=e.subscribe(o);return()=>i.unsubscribe()},[e,r]),t}a.createContext(void 0);var oe=a.createContext(void 0);function De(){return a.useContext(oe)}function ie(e){const n=De(),r=e??n;if(!r)throw new Error("No TrackRef, make sure you are inside a TrackRefContext or pass the TrackRef explicitly");return r}a.createContext(void 0);var J=a.createContext(void 0);function bn(){const e=a.useContext(J);if(!e)throw Error("tried to access room context outside of livekit room component");return e}function ce(){return a.useContext(J)}function K(e){const n=ce(),r=e??n;if(!r)throw new Error("No room provided, make sure you are inside a Room context or pass the room explicitly");return r}var Ue=a.createContext(void 0);function Ve(...e){return(...n)=>{for(const r of e)if(typeof r=="function")try{r(...n)}catch(t){console.error(t)}}}function B(...e){const n=C({},e[0]);for(let r=1;r<e.length;r++){const t=e[r];for(const o in t){const i=n[o],c=t[o];typeof i=="function"&&typeof c=="function"&&o[0]==="o"&&o[1]==="n"&&o.charCodeAt(2)>=65&&o.charCodeAt(2)<=90?n[o]=Ve(i,c):(o==="className"||o==="UNSAFE_className")&&typeof i=="string"&&typeof c=="string"?n[o]=Ae(i,c):n[o]=c!==void 0?c:i}}return n}function hn(e){const n=K(e),r=a.useMemo(()=>we(n),[n]);return V(r,n.state)}var je={connect:!0,audio:!1,video:!1};function Fe(e){const n=C(C({},je),e),{token:r,serverUrl:t,options:o,room:i,connectOptions:c,connect:h,audio:l,video:s,screen:d,onConnected:f,onDisconnected:p,onError:u,onMediaDeviceFailure:E,onEncryptionError:P,simulateParticipants:k}=n,S=O(n,["token","serverUrl","options","room","connectOptions","connect","audio","video","screen","onConnected","onDisconnected","onError","onMediaDeviceFailure","onEncryptionError","simulateParticipants"]);o&&i&&y.warn("when using a manually created room, the options object will be ignored. set the desired options directly when creating the room instead.");const[m,T]=a.useState();a.useEffect(()=>{T(i??new ue(o))},[i]);const N=a.useMemo(()=>{const{className:w}=Oe();return B(S,{className:w})},[S]);return a.useEffect(()=>{if(!m)return;const w=()=>{const _=m.localParticipant;y.debug("trying to publish local tracks"),Promise.all([_.setMicrophoneEnabled(!!l,typeof l!="boolean"?l:void 0),_.setCameraEnabled(!!s,typeof s!="boolean"?s:void 0),_.setScreenShareEnabled(!!d,typeof d!="boolean"?d:void 0)]).catch(A=>{y.warn(A),u==null||u(A)})},M=_=>{const A=de.getFailure(_);E==null||E(A)},W=_=>{P==null||P(_)};return m.on(b.SignalConnected,w).on(b.MediaDevicesError,M).on(b.EncryptionError,W),()=>{m.off(b.SignalConnected,w).off(b.MediaDevicesError,M).off(b.EncryptionError,W)}},[m,l,s,d,u,P,E]),a.useEffect(()=>{if(m){if(k){m.simulateParticipants({participants:{count:k},publish:{audio:!0,useRealTracks:!0}});return}if(!r){y.debug("no token yet");return}if(!t){y.warn("no livekit url provided"),u==null||u(Error("no livekit url provided"));return}h?(y.debug("connecting"),m.connect(t,r,c).catch(w=>{y.warn(w),u==null||u(w)})):(y.debug("disconnecting because connect is false"),m.disconnect())}},[h,r,JSON.stringify(c),m,u,t,k]),a.useEffect(()=>{if(!m)return;const w=M=>{switch(M){case q.Disconnected:p&&p();break;case q.Connected:f&&f();break}};return m.on(b.ConnectionStateChanged,w),()=>{m.off(b.ConnectionStateChanged,w)}},[r,f,p,m]),a.useEffect(()=>{if(m)return()=>{y.info("disconnecting on onmount"),m.disconnect()}},[m]),{room:m,htmlProps:N}}function vn(e={}){const n=K(e.room),[r,t]=a.useState(n.localParticipant),[o,i]=a.useState(r.isMicrophoneEnabled),[c,h]=a.useState(r.isMicrophoneEnabled),[l,s]=a.useState(r.lastMicrophoneError),[d,f]=a.useState(r.lastCameraError),[p,u]=a.useState(r.isMicrophoneEnabled),[E,P]=a.useState(void 0),[k,S]=a.useState(void 0),m=T=>{h(T.isCameraEnabled),i(T.isMicrophoneEnabled),u(T.isScreenShareEnabled),S(T.cameraTrack),P(T.microphoneTrack),s(T.participant.lastMicrophoneError),f(T.participant.lastCameraError),t(T.participant)};return a.useEffect(()=>{const T=z(n.localParticipant).subscribe(m);return()=>T.unsubscribe()},[n]),{isMicrophoneEnabled:o,isScreenShareEnabled:p,isCameraEnabled:c,microphoneTrack:E,cameraTrack:k,lastMicrophoneError:l,lastCameraError:d,localParticipant:r}}function $e(e){var n=e,{source:r,onChange:t,initialState:o,captureOptions:i,publishOptions:c,onDeviceError:h}=n,l=O(n,["source","onChange","initialState","captureOptions","publishOptions","onDeviceError"]),s;const d=ce(),f=(s=d==null?void 0:d.localParticipant)==null?void 0:s.getTrackPublication(r),p=a.useRef(!1),{toggle:u,className:E,pendingObserver:P,enabledObserver:k}=a.useMemo(()=>d?_e(r,d,i,c,h):Re(),[d,r,JSON.stringify(i),c]),S=V(P,!1),m=V(k,o??!!(f!=null&&f.isEnabled));a.useEffect(()=>{t==null||t(m,p.current),p.current=!1},[m,t]),a.useEffect(()=>{o!==void 0&&(y.debug("forcing initial toggle state",r,o),u(o))},[]);const T=a.useMemo(()=>B(l,{className:E}),[l,E]),N=a.useCallback(w=>{var M;p.current=!0,u().finally(()=>p.current=!1),(M=l.onClick)==null||M.call(l,w)},[l,u]);return{toggle:u,enabled:m,pending:S,track:f,buttonProps:H(C({},T),{"aria-pressed":m,"data-lk-source":r,"data-lk-enabled":m,disabled:S,onClick:N})}}function ze(e=[g.Source.Camera,g.Source.Microphone,g.Source.ScreenShare,g.Source.ScreenShareAudio,g.Source.Unknown],n={}){const r=K(n.room),[t,o]=a.useState([]),[i,c]=a.useState([]),h=a.useMemo(()=>e.map(s=>ee(s)?s.source:s),[JSON.stringify(e)]);return a.useEffect(()=>{const s=xe(r,h,{additionalRoomEvents:n.updateOnlyOn,onlySubscribed:n.onlySubscribed}).subscribe(({trackReferences:d,participants:f})=>{y.debug("setting track bundles",d,f),o(d),c(f)});return()=>s.unsubscribe()},[r,JSON.stringify(n.onlySubscribed),JSON.stringify(n.updateOnlyOn),JSON.stringify(e)]),a.useMemo(()=>{if(ne(e)){const s=Je(e,i),d=Array.from(t);return i.forEach(f=>{var p;s.has(f.identity)&&((p=s.get(f.identity))!=null?p:[]).forEach(E=>{if(t.find(({participant:k,publication:S})=>f.identity===k.identity&&S.source===E))return;y.debug(`Add ${E} placeholder for participant ${f.identity}.`);const P={participant:f,source:E};d.push(P)})}),d}else return t},[t,i,e])}function He(e,n){const r=new Set(e);for(const t of n)r.delete(t);return r}function Je(e,n){const r=new Map;if(ne(e)){const t=e.filter(o=>o.withPlaceholder).map(o=>o.source);n.forEach(o=>{const i=o.getTrackPublications().map(h=>{var l;return(l=h.track)==null?void 0:l.source}).filter(h=>h!==void 0),c=Array.from(He(new Set(t),new Set(i)));c.length>0&&r.set(o.identity,c)})}return r}var Ke=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},e),a.createElement("path",{d:"M1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708L11 10.293V4.5A1.5 1.5 0 0 0 9.5 3H3.707zM0 4.5a1.5 1.5 0 0 1 .943-1.393l9.532 9.533c-.262.224-.603.36-.975.36h-8A1.5 1.5 0 0 1 0 11.5z"}),a.createElement("path",{d:"m15.2 3.6-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4"})),Be=Ke,We=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},e),a.createElement("path",{d:"M0 4.5A1.5 1.5 0 0 1 1.5 3h8A1.5 1.5 0 0 1 11 4.5v7A1.5 1.5 0 0 1 9.5 13h-8A1.5 1.5 0 0 1 0 11.5zM15.2 3.6l-2.8 2.1a1 1 0 0 0-.4.8v3a1 1 0 0 0 .4.8l2.8 2.1a.5.5 0 0 0 .8-.4V4a.5.5 0 0 0-.8-.4"})),qe=We,Qe=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},e),a.createElement("path",{d:"M12.227 11.52a5.48 5.48 0 0 0 1.246-2.97.5.5 0 0 0-.995-.1 4.5 4.5 0 0 1-.962 2.359l-1.07-1.07C10.794 9.247 11 8.647 11 8V3a3 3 0 0 0-6 0v1.293L1.354.646a.5.5 0 1 0-.708.708l14 14a.5.5 0 0 0 .708-.708zM8 12.5c.683 0 1.33-.152 1.911-.425l.743.743c-.649.359-1.378.59-2.154.66V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.5 5.5 0 0 1-4.973-4.929.5.5 0 0 1 .995-.098A4.5 4.5 0 0 0 8 12.5"}),a.createElement("path",{d:"M8.743 10.907 5 7.164V8a3 3 0 0 0 3.743 2.907"})),Ge=Qe,Xe=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"currentColor"},e),a.createElement("path",{fillRule:"evenodd",d:"M2.975 8.002a.5.5 0 0 1 .547.449 4.5 4.5 0 0 0 8.956 0 .5.5 0 1 1 .995.098A5.5 5.5 0 0 1 8.5 13.478V15h2a.5.5 0 0 1 0 1h-5a.5.5 0 0 1 0-1h2v-1.522a5.5 5.5 0 0 1-4.973-4.929.5.5 0 0 1 .448-.547",clipRule:"evenodd"}),a.createElement("path",{d:"M5 3a3 3 0 1 1 6 0v5a3 3 0 0 1-6 0z"})),Ye=Xe,Ze=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},e),a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M0 2.75A2.75 2.75 0 0 1 2.75 0h14.5A2.75 2.75 0 0 1 20 2.75v10.5A2.75 2.75 0 0 1 17.25 16H2.75A2.75 2.75 0 0 1 0 13.25zM2.75 1.5c-.69 0-1.25.56-1.25 1.25v10.5c0 .69.56 1.25 1.25 1.25h14.5c.69 0 1.25-.56 1.25-1.25V2.75c0-.69-.56-1.25-1.25-1.25z",clipRule:"evenodd"}),a.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M9.47 4.22a.75.75 0 0 1 1.06 0l2.25 2.25a.75.75 0 0 1-1.06 1.06l-.97-.97v4.69a.75.75 0 0 1-1.5 0V6.56l-.97.97a.75.75 0 0 1-1.06-1.06z",clipRule:"evenodd"})),en=Ze,nn=e=>a.createElement("svg",C({xmlns:"http://www.w3.org/2000/svg",width:20,height:16,fill:"none"},e),a.createElement("g",{fill:"currentColor"},a.createElement("path",{d:"M7.28 4.22a.75.75 0 0 0-1.06 1.06L8.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L10 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L11.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L10 6.94z"}),a.createElement("path",{fillRule:"evenodd",d:"M2.75 0A2.75 2.75 0 0 0 0 2.75v10.5A2.75 2.75 0 0 0 2.75 16h14.5A2.75 2.75 0 0 0 20 13.25V2.75A2.75 2.75 0 0 0 17.25 0zM1.5 2.75c0-.69.56-1.25 1.25-1.25h14.5c.69 0 1.25.56 1.25 1.25v10.5c0 .69-.56 1.25-1.25 1.25H2.75c-.69 0-1.25-.56-1.25-1.25z",clipRule:"evenodd"}))),tn=nn;function rn(e){return e!==void 0}function an(...e){return B(...e.filter(rn))}function on(e,n,r){return a.Children.map(e,t=>a.isValidElement(t)&&a.Children.only(e)?a.cloneElement(t,H(C({},n),{key:r})):t)}function cn(e,n){switch(e){case g.Source.Microphone:return n?a.createElement(Ye,null):a.createElement(Ge,null);case g.Source.Camera:return n?a.createElement(qe,null):a.createElement(Be,null);case g.Source.ScreenShare:return n?a.createElement(tn,null):a.createElement(en,null);default:return}}var mn=a.forwardRef(function(n,r){var t=n,{showIcon:o}=t,i=O(t,["showIcon"]);const{buttonProps:c,enabled:h}=$e(i);return a.createElement("button",C({ref:r},c),(o??!0)&&cn(i.source,h),i.children)});function se(e,n={}){var r;const[t,o]=a.useState(U(e)),[i,c]=a.useState(t==null?void 0:t.isMuted),[h,l]=a.useState(t==null?void 0:t.isSubscribed),[s,d]=a.useState(t==null?void 0:t.track),[f,p]=a.useState("landscape"),u=a.useRef(),{className:E,trackObserver:P}=a.useMemo(()=>Ce(e),[(r=e.participant.sid)!=null?r:e.participant.identity,e.source,F(e)&&e.publication.trackSid]);return a.useEffect(()=>{const k=P.subscribe(S=>{y.debug("update track",S),o(S),c(S==null?void 0:S.isMuted),l(S==null?void 0:S.isSubscribed),d(S==null?void 0:S.track)});return()=>k==null?void 0:k.unsubscribe()},[P]),a.useEffect(()=>{var k,S;return s&&(u.current&&s.detach(u.current),(k=n.element)!=null&&k.current&&!(Z(e.participant)&&(s==null?void 0:s.kind)==="audio")&&s.attach(n.element.current)),u.current=(S=n.element)==null?void 0:S.current,()=>{u.current&&(s==null||s.detach(u.current))}},[s,n.element]),a.useEffect(()=>{var k,S;if(typeof((k=t==null?void 0:t.dimensions)==null?void 0:k.width)=="number"&&typeof((S=t==null?void 0:t.dimensions)==null?void 0:S.height)=="number"){const m=t.dimensions.width>t.dimensions.height?"landscape":"portrait";p(m)}},[t]),{publication:t,isMuted:i,isSubscribed:h,track:s,elementProps:an(n.props,C({className:E,"data-lk-local-participant":e.participant.isLocal,"data-lk-source":t==null?void 0:t.source},(t==null?void 0:t.kind)==="video"&&{"data-lk-orientation":f}))}}var Sn=a.forwardRef(function(n,r){var t=n,{onTrackClick:o,onClick:i,onSubscriptionStatusChanged:c,trackRef:h,manageSubscription:l}=t,s=O(t,["onTrackClick","onClick","onSubscriptionStatusChanged","trackRef","manageSubscription"]);const d=ie(h),f=a.useRef(null);a.useImperativeHandle(r,()=>f.current);const p=be(f,{}),u=he(p,3e3);a.useEffect(()=>{l&&d.publication instanceof I&&(u==null?void 0:u.isIntersecting)===!1&&(p==null?void 0:p.isIntersecting)===!1&&d.publication.setSubscribed(!1)},[u,d,l]),a.useEffect(()=>{l&&d.publication instanceof I&&(p==null?void 0:p.isIntersecting)===!0&&d.publication.setSubscribed(!0)},[p,d,l]);const{elementProps:E,publication:P,isSubscribed:k}=se(d,{element:f,props:s});a.useEffect(()=>{c==null||c(!!k)},[k,c]);const S=m=>{i==null||i(m),o==null||o({participant:d==null?void 0:d.participant,track:P})};return a.createElement("video",H(C({ref:f},E),{muted:!0,onClick:S}))}),sn=a.forwardRef(function(n,r){var t=n,{trackRef:o,onSubscriptionStatusChanged:i,volume:c,muted:h}=t,l=O(t,["trackRef","onSubscriptionStatusChanged","volume","muted"]);const s=ie(o),d=a.useRef(null);a.useImperativeHandle(r,()=>d.current);const{elementProps:f,isSubscribed:p,track:u,publication:E}=se(s,{element:d,props:l});return a.useEffect(()=>{i==null||i(!!p)},[p,i]),a.useEffect(()=>{u===void 0||c===void 0||(u instanceof fe?u.setVolume(c):y.warn("Volume can only be set on remote audio tracks."))},[c,u]),a.useEffect(()=>{E===void 0||h===void 0||(E instanceof I?E.setEnabled(!h):y.warn("Can only call setEnabled on remote track publications."))},[h,E,u]),a.createElement("audio",C({ref:d},f))});function gn(e){var n=e,{tracks:r}=n,t=O(n,["tracks"]);return a.createElement(a.Fragment,null,r.map(o=>a.createElement(oe.Provider,{value:o,key:Y(o)},on(t.children))))}var En=a.forwardRef(function(n,r){const{room:t,htmlProps:o}=Fe(n);return a.createElement("div",C({ref:r},o),t&&a.createElement(J.Provider,{value:t},a.createElement(Ue.Provider,{value:n.featureFlags},n.children)))});function kn({volume:e,muted:n}){const r=ze([g.Source.Microphone,g.Source.ScreenShareAudio,g.Source.Unknown],{updateOnlyOn:[],onlySubscribed:!0}).filter(t=>!Z(t.participant)&&t.publication.kind===g.Kind.Audio);return a.createElement("div",{style:{display:"none"}},r.map(t=>a.createElement(sn,{key:Y(t),trackRef:t,volume:e,muted:n})))}export{En as L,kn as R,mn as T,Sn as V,vn as a,ze as b,hn as c,gn as d,oe as e,bn as u};
