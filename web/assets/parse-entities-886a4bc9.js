import{c as T}from"./character-entities-legacy-d39742d7.js";import{c as D}from"./character-reference-invalid-da0c882b.js";import{i as U}from"./is-decimal-dfcce753.js";import{i as z}from"./is-hexadecimal-f403e296.js";import{i as H}from"./is-alphanumerical-4b9c73ef.js";import{d as L}from"./decode-named-character-reference-29ded5ae.js";const N=String.fromCharCode,B=["","Named character references must be terminated by a semicolon","Numeric character references must be terminated by a semicolon","Named character references cannot be empty","Numeric character references cannot be empty","Named character references must be known","Numeric character references cannot be disallowed","Numeric character references cannot be outside the permissible Unicode range"];function V(t,r={}){const E=typeof r.additional=="string"?r.additional.charCodeAt(0):r.additional,R=[];let d=0,I=-1,h="",o,k;r.position&&("start"in r.position||"indent"in r.position?(k=r.position.indent,o=r.position.start):o=r.position);let j=(o?o.line:0)||1,x=(o?o.column:0)||1,y=w(),u;for(d--;++d<=t.length;)if(u===10&&(x=(k?k[I]:0)||1),u=t.charCodeAt(d),u===38){const i=t.charCodeAt(d+1);if(i===9||i===10||i===12||i===32||i===38||i===60||Number.isNaN(i)||E&&i===E){h+=N(u),x++;continue}const l=d+1;let s=l,n=l,a;if(i===35){n=++s;const e=t.charCodeAt(n);e===88||e===120?(a="hexadecimal",n=++s):a="decimal"}else a="named";let p="",g="",f="";const S=a==="named"?H:a==="decimal"?U:z;for(n--;++n<=t.length;){const e=t.charCodeAt(n);if(!S(e))break;f+=N(e),a==="named"&&T.includes(f)&&(p=f,g=L(f))}let C=t.charCodeAt(n)===59;if(C){n++;const e=a==="named"?L(f):!1;e&&(p=f,g=e)}let m=1+n-l,b="";if(!(!C&&r.nonTerminated===!1))if(!f)a!=="named"&&c(4,m);else if(a==="named"){if(C&&!g)c(5,1);else if(p!==f&&(n=s+p.length,m=1+n-s,C=!1),!C){const e=p?1:3;if(r.attribute){const A=t.charCodeAt(n);A===61?(c(e,m),g=""):H(A)?g="":c(e,m)}else c(e,m)}b=g}else{C||c(2,m);let e=Number.parseInt(f,a==="hexadecimal"?16:10);if(F(e))c(7,m),b=N(65533);else if(e in D)c(6,m),b=D[e];else{let A="";G(e)&&c(6,m),e>65535&&(e-=65536,A+=N(e>>>10|55296),e=56320|e&1023),b=A+N(e)}}if(b){q(),y=w(),d=n-1,x+=n-l+1,R.push(b);const e=w();e.offset++,r.reference&&r.reference.call(r.referenceContext,b,{start:y,end:e},t.slice(l-1,n)),y=e}else f=t.slice(l-1,n),h+=f,x+=f.length,d=n-1}else u===10&&(j++,I++,x=0),Number.isNaN(u)?q():(h+=N(u),x++);return R.join("");function w(){return{line:j,column:x,offset:d+((o?o.offset:0)||0)}}function c(i,l){let s;r.warning&&(s=w(),s.column+=l,s.offset+=l,r.warning.call(r.warningContext,B[i],s,i))}function q(){h&&(R.push(h),r.text&&r.text.call(r.textContext,h,{start:y,end:w()}),h="")}}function F(t){return t>=55296&&t<=57343||t>1114111}function G(t){return t>=1&&t<=8||t===11||t>=13&&t<=31||t>=127&&t<=159||t>=64976&&t<=65007||(t&65535)===65535||(t&65535)===65534}export{V as p};
